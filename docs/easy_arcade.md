# EASY ARCADE 2 取扱説明書

EASY ARCADE 2(以下EA2)はJAMMAコネクタを採用したアーケードゲーム基板を遊ぶための簡易アダプタです（いわゆるコントロールボックス、Supergun）。
USB-PD電源とUSBコントローラーを使用することで気軽に遊べる環境となることを目指しています。

## 電気的仕様
### 電源入力
20V出力可能なUSB-PD電源を使用してください。
65Wまでの USB-PD電源が使用できます。

### JAMMA 側定格電源出力
- 5V: 10A 以下
- 12V: 0.7A 以下
- -5V: 0.2A 以下

実際に出力可能な電流は入力電源のスペックによります。
たとえば、5V 10A の基板を遊ぶためには 65W 級の電源を用意する必要があります。
出力に応じて発熱が増えますので、安全のため 5V 10A 以上を要求するアーケード基板に使用することは避けてください。

## 各部の説明

![基板画像](ea2_description.png)

### JAMMAコネクタ
アーケード基板を接続します。
EA2の部品面が基板部品面です。逆挿しに注意してください。

### USB-A コネクタ
USB コントローラーを接続します。
右側がプレイヤー1、左側がプレイヤー2に対応します。

### USB-C コネクタ
USB-PD 電源を接続します。

### USB-Micro コネクタ
ファームウェアアップデート用です。
通常は何も接続しないでください。
また、絶対に USB-C と USB-Micro 双方から電源供給しないようにしてください。

### ジャンパピン
後述のファームウェアアップデート時に外します。通常使用時は接続したままにしてください。

### AVマルチコネクタ
SFC仕様のRGBケーブルを接続します。
横棒の印刷のある基板部品面側がSFC RGBコネクタの凸がある方向になります。
出力はRGB信号のみとなり、コンポジットビデオやSビデオは出力されません。

C-SYNC は 3, 7, 9 ピンに出力されていますのでケーブルを選ぶことはないはずです。

### 液晶画面
各種状態表示や各種設定を行うために使用します。

液晶画面は特に破損しやすいため、アーケード基板からの着脱の際などに、力をかけないようにご注意ください。

### POWER/CONFIG ボタン
電源のOn/Off および、メニューの開閉に使用します。

ℹ️ 電源OFF時に電源ボタンを20秒押し続けると出荷時状態に初期化します。(v1.0.2-)

### TEST, SERVICE ボタン
JAMMA側の TEST, SERVICE に接続されています。

### CSyncレベル選択スイッチ
アーケード基板からのCSync出力は映像規格の1Vppを大きく超えた電圧で出力されていることが多く、そのまま現代のスキャンコンバーター等に入力すると機器にダメージを与える可能性があります。
このスイッチを右側に設定するとCSyncをクランプし2Vまでに制限します（75Ω 終端されて 1 Vpp になるはず…）。
左側に切り替えると元の信号をパススルーします。

### 拡張コネクタ
キックハーネスの接続や将来の拡張機能のためのコネクタです。
JAMMA コネクタに出ていない D, E, Fボタンが出力されます。
キック出力として使用する際は、ピンの対応関係をよく確認し適切な配線を行ってください。

**⚠️ ストリートファイターⅡ等の拡張コネクタと配列が異なります。ストレートに直結するような事の無いようご注意ください。**

ピンアサインは左から 

 - 5V
 - 1P D
 - 2P D
 - 1P E
 - 2P E
 - 1P F
 - 2P F 
 - GND
 - SDA
 - SCL

となります。


### デバッグ端子
通常は使用しません。

ピンアサインは上から

- GND
- SWDIO
- SWCLK
- UART TX

となっています。

### コインセレクタ入力

コインセレクタを接続するための端子を実装できます。
JST-PH 3pin コネクタが適合します。

上から
 
- 12V
- SERVICE
- GND

となります。
後述の説明をよく読んで、わかる人のみご使用ください。


## 使い方

初期設定では、USB-CポートにUSB-PD電源からのケーブルを接続すると待機状態に移行します。

### 電源On
POWER/CONFIG ボタンを押すと電源がJAMMA側に供給されます。

### 電源Off
以下の2つの方法でJAMMA側の電源を切ることができます。
- POWER/CONFIGボタンを5秒間押し続ける
- コントローラーの CMD + START + COIN を押す

### メニュー

電源Onの時にPOWER/CONFIGボタンを押すことで各種設定メニューが開閉します。
メニュー表示中にはコントローラーの上下で項目を選択、左右で項目の値を変更できます。
 
**保存系の項目で保存された状態が実際に書き込まれるのはメニューを閉じたタイミングになります。設定後、電源を切る前にメニューを閉じるようにしてください。**

- BtnCfg
  - コントローラーのボタンとJAMMA側のボタン出力のマッピングを行います
  - 別項にて説明します

- PowMode
  - USB-PD電源を接続した際の電源On/Off状態を設定します
  - InitOnにすると接続時から電源が入るようになります

- DispFPS
  - Idle画面に、基板の画面出力のV-Sync周波数を表示するかどうかを設定します
  - 計測がいい加減であまり精度はありません。目安として。

- BtnDisp
  - Idle画面に、表示するボタン状態を選択します
    - Input: 入力しているボタンを表示します
    - Rapid: 連射が有効になっているボタンを表示します
    - None: ボタン状態を表示しません

- BackLit
  - バックライトの点灯設定を行います

- RapidMd
  - 連射モードを選択します
    - Softw: 単純なタイミングによる連射を使用します
    - Synchro: V-Syncに同期した連射を使用します

- SwRapid
  - 連射モードが softw の時の連射速度を設定します

- Phase A-F
  - 連射の位相(面裏)の設定をします
  - In/Out でOn/Offが逆転しています

- InitRpd
  - 連射関連設定を初期化します

- SaveRpd
  - 現在の連射有効状態を保存し、次の電源投入時に復帰するようにします
  - 保存しない連射状態は電源Onのたびに初期化されます

- (RotEncX)
  - LEFT, RIGHT ピンに接続するタイプのロータリーエンコーダに対して、コントローラーのアナログ入力の指定した軸を割り当てます

- (RotEncY)
  - UP, DOWN ピンに接続するタイプのロータリーエンコーダに対して、コントローラーのアナログ入力の指定した軸を割り当てます

- (REncX S)
  - LEFT, RIGHT ピンに接続するタイプのロータリーエンコーダに対する速度スケールを設定します

- (REncY S)
  - UP, DOWN ピンに接続するタイプのロータリーエンコーダに対する速度スケールを設定します

- (RotEncX)
  - LEFT, RIGHT ピンに接続するタイプのロータリーエンコーダに対して、回転方向を指定します
  
- (RotEncY)
  - UP, DOWN ピンに接続するタイプのロータリーエンコーダに対して、回転方向を指定します

- InitAll
  - ボタン設定を含むすべての状態を初期化します


(括弧)付きの項目は試験的な機能で動作を保証しません。将来的に廃止、整理される可能性があります。

## ボタン設定

BtnCfg メニューから、POWER/CONFIGボタンを２秒長押しすると、USBコントローラーとJAMMA側ボタン出力のマッピング設定モードに入ります。

PUSH ↑ などの表示に従って割り当てたいUSBコントローラーのレバーやボタンを入力することでマッピングが行えます。
複数のボタンを押すことで JAMMA 側のボタンに対して複数の入力側のボタンを割り当てることも可能です。
また、同じボタンを異なる JAMMA 側ボタンに割り当てることもできます。

これらを組み合わせると、たとえば、

- JAMMA 側 A, B ボタンを１つのボタンで同時に押す
- JAMMA 側 C ボタンを 2つのボタンに割り当て、片方を連射、もう片方を非連射にする

など自由に設定することができます。

また、ボタン設定中、POWER/CONFIG ボタンを押すとそのボタンへのマッピングをスキップ(未割り当て)することができます。

同一のコントローラーは 1P, 2P どちらのポートにも同じ設定が適用されます。

### CMDボタン
Push CMD と表示されるボタン割り当ては JAMMA 側のボタンに対応するものではなく、連射設定や電源 Off に使用するボタンとなります。

## 連射設定

CMDボタンと連射したいボタンを同時に押すと連射が有効になります。
連射は入力側のボタン個別に有効にすることができるので、JAMMA側のボタンに対して入力側の複数のボタンを割り当てておくことで、連射ありと連射のないボタンの使い分けも可能です。

CMDボタンと上下で基本連射速度からの分周比を設定できます。分周比は Idle 画面で確認できます。


## 対応コントローラー
- USB-HID コントローラー(PS3, 4, 5 のコントローラーを含む)
- XBOX コントローラー
- USB-MIDI

## ファームウェアアップデート

ファームウェアの更新は以下の手順で行ってください。
1. EA2 に接続されているケーブル類を全て外す
1. USB micro コネクタ左の**ジャンパピン２つを抜く**
1. USB micro コネクタにUSBケーブルを接続する
1. **POWER/CONFIG ボタンを押しながら** PC に接続
1. USB ストレージデバイスとして認識されるので、 配布されている firmware.uf2 をドラッグアンドドロップ
1. USB ケーブルを抜き、**ジャンパピン２つを元に戻す**

最新版のファームウェアは以下のページでダウンロード可能です。 

[v1.0.2](https://github.com/shuichitakano/easy_arcade/releases/download/v1.0.2/firmware_v1_0_2.zip)

ファームウェアをアップデートすると、バージョンにより全ての設定がリセットされることがあります。
あらかじめご了承ください。

**⚠️ USB micro コネクタは強固に固定されていません。挿抜時の破損にご注意ください。**


## 使用できるコインセレクタについて

本機にはコインセレクタを接続するのに利用できる端子が用意されています。
コネクタは実装されていませんので必要に応じて実装してください。

接続できるコインセレクタは以下のようなものです。

- パッシブのスイッチを用いたもの
- オープンドレイン出力でプルアップされていないもの

Amazon 等で手に入るコインセレクタの中にはコイン出力が 12V のものがあります
（返却機構がレバーのものはダメでした）。
そのような機器をつなぐと、人類の財産であるところのアーケード基板に深刻なダメージを与えますので、絶対に使用しないでください。

これらの説明で意味がわかる人のみがご使用ください。



## ⚠️ 使用上のご注意

本製品は個人制作物であり、製品の破損や、使用に伴う家財および人体への被害に対する保証を行うことはできません。
使用上の注意をよく理解したうえで、安全に配慮した運用を心がけてください。

### 定格以内で使用する
5V 10A 以上を要求するアーケードゲーム機器に使用することを避けてください。
発熱による火災などの恐れがあります。

### 電源を入れたまま目を離さない
製品の安全には配慮していますが、定格内での使用であっても異常発熱が起こる可能性が無いとは言えません。
電源投入状態で放置することは避けてください。

また、使用しないときは電源ケーブルを抜いてください。

### 逆挿しに注意する
EA2 部品面が JAMMA の部品面に対応します。
逆に接続することにより製品にダメージを与える可能性があるだけでなく、貴重なアーケードゲーム基板を破壊することにもつながります。

### 発熱に注意する
動作中は特にコイル周辺が発熱します。やけど等に注意てください。
ゲーム基板からの着脱は電源を切り、冷やしてから行ってください。

### 着脱時の破損・怪我に注意する
精密機器ですので大きな力をかけると破損の可能性があります。ゲーム基板からの着脱時のにはご注意ください。特に液晶は壊れやすく、着脱時に押さえることは避けてください。

また、拡張端子のピンヘッダなど尖った部分がありますので、怪我にご注意ください。

### おかしな動作が起こったら電源を抜く
ファームウェアのバグ等により、おかしな動作が起こることがあります。
電源を切って解消しない場合は電源コネクタからケーブルを抜いてください。

## 現状動作しないデバイス

動作しないことが確認されているデバイスがあります。

- SEGA Saturn 2.4GHz Wireless Pro Controller
  - USBスタックからreportが上がってこない
  - 挿した後に他のUSBも認識しなくなり、復帰には電源挿抜が必要。
  
## お問い合わせ
バグや製品の問題、動作しないコントローラーの情報などは、[X(旧twitter)](https://x.com/shuichi_takano) 宛にお願いします。
